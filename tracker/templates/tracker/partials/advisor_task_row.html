<tr id="adv-task-{{ task.pk }}">
  <td>{{ task.milestone.name }}</td>
  <td>
    {{ task.title }}
    {% if task.template and task.template.guidance_tips or task.template and task.template.guidance_url %}
      <button type="button"
              class="badge rounded-pill text-bg-info ms-1 border-0"
              style="cursor:pointer"
              title="View quick guidance"
              data-bs-toggle="tooltip"
              hx-get="{% url 'task_guidance' task.pk %}"
              hx-target="#guidance-body"
              hx-swap="innerHTML">
        Tips
      </button>
    {% endif %}
    {% if show_effort %}
      <form method="post" action="{% url 'task_target' task.pk %}" class="d-inline ms-2" hx-post="{% url 'task_target' task.pk %}" hx-target="#adv-task-{{ task.pk }}" hx-swap="outerHTML">{% csrf_token %}
        <span class="text-muted small">Target:</span>
        <input name="word_target" type="number" min="0" value="{{ task.word_target|default:0 }}" class="form-control form-control-sm d-inline" style="width: 6.5rem; display:inline-block;" />
        <button class="btn btn-sm btn-outline-secondary">Save</button>
      </form>
      {% if task.effort_pct >= 75 %}
        <span class="badge text-bg-success">Effort {{ task.effort_pct }}%</span>
      {% elif task.effort_pct >= 30 %}
        <span class="badge text-bg-warning">Effort {{ task.effort_pct }}%</span>
      {% else %}
        <span class="badge text-bg-danger">Effort {{ task.effort_pct }}%</span>
      {% endif %}
      <span class="badge text-bg-light ms-1">Combined {{ task.combined_pct }}%</span>
    {% endif %}
  </td>
  <td>
    <form id="adv-form-{{ task.pk }}" method="post" action="{% url 'task_status' task.pk %}" hx-post="{% url 'task_status' task.pk %}" hx-target="#adv-task-{{ task.pk }}" hx-swap="outerHTML">{% csrf_token %}
      <input type="hidden" name="percent" value="{{ task.progress_percent }}" />
      <input type="range" min="0" max="100" step="5" list="progressTicks"
             value="{{ task.progress_percent }}"
             class="form-range flex-grow-1 progress-slider"
             title="Progress: move to update status (0%=To Do, 1-99%=Doing, 100%=Done)" style="min-width:120px;" />
      <select name="status" class="form-select d-none" onchange="this.form.requestSubmit()">
        <option value="todo" {% if task.status == 'todo' %}selected{% endif %}>To Do</option>
        <option value="doing" {% if task.status == 'doing' %}selected{% endif %}>Doing</option>
        <option value="done" {% if task.status == 'done' %}selected{% endif %}>Done</option>
      </select>
    </form>
  </td>
  <td>
    <select name="status-display" class="form-select form-select-sm" onchange="var f=document.getElementById('adv-form-{{ task.pk }}'); f.querySelector('select[name=status]').value=this.value; f.requestSubmit();">
      <option value="todo" {% if task.status == 'todo' %}selected{% endif %}>To Do</option>
      <option value="doing" {% if task.status == 'doing' %}selected{% endif %}>Doing</option>
      <option value="done" {% if task.status == 'done' %}selected{% endif %}>Done</option>
    </select>
  </td>
</tr>
